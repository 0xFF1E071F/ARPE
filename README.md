
# ARPE
**ARPE** is an **A**uto-**R**eplicant **P**olymorphic **E**ncrypted program written in x86-64 assembly language (NASM, Windows ABI).  
It contains a simple example of a polymorphic engine.  

## How it works

**ARPE** is composed by two parts:  
1. the decryption function  
2. the polymoprhic engine  

When **ARPE** is executed it decrypts the polymorphic engine and replicates itself. The program encrypts/decrypts 16 bytes at a time because the bytes to encrypt/decrypt are placed in the registers _eax_, _ecx_, _edx_ and _ebx_. When it replicates it generates a new encryption function randomly using only 12 invertible instructions applied to the four general pourpose registers. The decryption function is also generated by simply reversing the instructions of the encryption function (e.g. _add eax, ecx_ <=> _sub eax, ecx_). So the program encrypts the next generation copy of itself with the new encryption function and places the corresponding decryption function. Then it saves the executable file (in the same directory where it is placed).  

For example, here is a portion of a randomly generated encryption function ...  
```x86asm
0000000000401B13 | C1 C1 17           | rol ecx,17              |
0000000000401B16 | 01 D0              | add eax,edx             |
0000000000401B18 | 29 C3              | sub ebx,eax             |
0000000000401B1A | C1 CA 01           | ror edx,1               |
0000000000401B1D | 29 D0              | sub eax,edx             |
0000000000401B1F | C1 CB 07           | ror ebx,7               |
0000000000401B22 | 31 D0              | xor eax,edx             |
0000000000401B24 | 81 F0 33 0F 00 00  | xor eax,F33             |
0000000000401B2A | 81 F1 09 33 00 00  | xor ecx,3309            |
0000000000401B30 | F7 D1              | not ecx                 |
0000000000401B32 | 81 F2 C3 24 00 00  | xor edx,24C3            |
0000000000401B38 | C1 C2 19           | rol edx,19              |
0000000000401B3B | FF C9              | dec ecx                 |
0000000000401B3D | 81 C3 61 00 00 00  | add ebx,61              |
```
... and here is the corresponding portion of the decryption function.  
```x86asm
00000000004016A7 | 81 EB 61 00 00 00  | sub ebx,61              |
00000000004016AD | FF C1              | inc ecx                 |
00000000004016AF | C1 CA 19           | ror edx,19              |
00000000004016B2 | 81 F2 C3 24 00 00  | xor edx,24C3            |
00000000004016B8 | F7 D1              | not ecx                 |
00000000004016BA | 81 F1 09 33 00 00  | xor ecx,3309            |
00000000004016C0 | 81 F0 33 0F 00 00  | xor eax,F33             |
00000000004016C6 | 31 D0              | xor eax,edx             |
00000000004016C8 | C1 C3 07           | rol ebx,7               |
00000000004016CB | 01 D0              | add eax,edx             |
00000000004016CD | C1 C2 01           | rol edx,1               |
00000000004016D0 | 01 C3              | add ebx,eax             |
00000000004016D2 | 29 D0              | sub eax,edx             |
00000000004016D4 | C1 C9 17           | ror ecx,17              |
```

## License
This project is licensed under the **zlib** license.

